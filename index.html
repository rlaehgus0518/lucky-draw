<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Lucky Draw</title>
<style>
  :root{ --panel:#0f1724; --accent:#ffd166; --text:#f8fafc; --rowh:48px; }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,"Apple SD Gothic Neo","Malgun Gothic",sans-serif;background:#07122a;color:var(--text);}
  .wrap{min-height:100vh;display:flex;flex-direction:column;align-items:center;gap:22px;padding:32px;box-sizing:border-box}
  .title{font-size:128px;font-weight:1000;letter-spacing:2px;color:#e8edf7;text-shadow:0 6px 26px rgba(0,0,0,.45)}
  .stage{width:100%;max-width:1200px;display:flex;justify-content:center;}
  .centerStack{display:flex;flex-direction:column;gap:18px;align-items:center}

  .panel{width:520px;max-width:90vw;border-radius:12px;background:linear-gradient(180deg,#071a2b,#052036);
    display:flex;align-items:center;justify-content:center;padding:18px 20px;box-sizing:border-box;overflow:hidden;
    box-shadow:0 10px 30px rgba(2,6,23,0.6)}
  .display{display:flex;gap:12px;align-items:center;z-index:2}
  .wheel{
    width:120px;background:linear-gradient(180deg,#0a2736,#06202c);
    border-radius:10px;display:flex;align-items:center;justify-content:center;
    overflow:hidden;position:relative;border:2px solid rgba(255,255,255,0.04)
  }
  .digit-strip{
    position:absolute;top:0;left:0;right:0;display:block;transform:translateY(0);
    will-change:transform; backface-visibility:hidden;
  }
  .digit{
    height:48px;line-height:48px;text-align:center;font-weight:800;font-size:44px;color:var(--accent);
    text-shadow:0 2px 8px rgba(0,0,0,0.6);
  }
  .wheel::before,.wheel::after{content:"";position:absolute;left:0;right:0;height:28%;pointer-events:none}
  .wheel::before{top:0;background:linear-gradient(to bottom,rgba(7,18,42,.85),rgba(7,18,42,0))}
  .wheel::after{bottom:0;background:linear-gradient(to top,rgba(7,18,42,.85),rgba(7,18,42,0))}
  .focus-frame{
    position:absolute;left:8px;right:8px;top:0;bottom:0;margin:auto;
    height:calc(var(--digitH,48px));
    border:3px solid rgba(255,209,102,.9);border-radius:10px;
    box-shadow:0 0 16px rgba(255,209,102,.25),inset 0 0 8px rgba(255,209,102,.25);
    pointer-events:none;
  }

  .actions{display:flex;gap:10px;margin-top:8px;}
  .btn{background:transparent;border:1px solid rgba(255,255,255,0.08);padding:12px 18px;border-radius:12px;color:#fff;cursor:pointer;font-weight:800}
  .btn.primary{background:var(--accent);color:#081022;border:0}
  .btn:active{transform:translateY(1px)}
  .big-result-wrap{width:520px;max-width:90vw;background:rgba(10,20,35,.55);border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:12px 16px;margin-top:12px;}
  .big-result{text-align:center;font-size:112px;font-weight:1000;color:#ffe08a;text-shadow:0 6px 24px rgba(0,0,0,.5)}
  .range-set{display:flex;gap:10px;align-items:center;margin-top:10px;font-size:18px;}
  input{width:100px;padding:6px 8px;border-radius:6px;border:none;text-align:center;font-size:16px;}

  /* 기록 도크 */
  .historyDock{
    position:fixed;right:24px;top:170px;width:360px;
    background:rgba(10,20,35,.55);border:1px solid rgba(255,255,255,.06);
    border-radius:12px;padding:12px;backdrop-filter:blur(2px);
    box-shadow:0 10px 30px rgba(2,6,23,.6);
  }
  .rows{display:flex;flex-direction:column;gap:8px;overflow:auto;max-height:calc(var(--rowh)*6 + 16px);}
  .row{display:flex;align-items:center;justify-content:space-between;background:rgba(255,255,255,.06);border-radius:10px;padding:10px 12px;font-size:20px;height:var(--rowh)}
  .row .idx{font-size:12px;color:#b9c2d8}
  .clear-line{display:flex;justify-content:flex-end;margin-top:10px}
  .clear{font-size:12px;padding:6px 10px;border-radius:8px;border:1px solid rgba(255,255,255,.12);background:transparent;color:#dbe3f9}

  /* 폭죽 캔버스 */
  #fx{position:fixed;inset:0;pointer-events:none;z-index:50}
</style>
</head>
<body>
<canvas id="fx"></canvas>
<div class="wrap">
  <div class="title">Lucky Draw</div>
  <div class="stage">
    <div class="centerStack">
      <div class="panel">
        <div class="display">
          <div class="wheel" data-pos="h"><div class="digit-strip"></div><div class="focus-frame"></div></div>
          <div class="wheel" data-pos="t"><div class="digit-strip"></div><div class="focus-frame"></div></div>
          <div class="wheel" data-pos="o"><div class="digit-strip"></div><div class="focus-frame"></div></div>
        </div>
      </div>

      <div class="range-set">
        <label>범위:</label>
        <input type="number" id="minInput" value="1" min="0">
        <span>~</span>
        <input type="number" id="maxInput" value="100" min="0">
      </div>

      <div class="actions">
        <button class="btn primary" id="drawBtn">추첨</button>
        <button class="btn" id="resetBtn">Reset</button>
      </div>

      <div class="big-result-wrap">
        <div id="bigResult" class="big-result">—</div>
      </div>
    </div>
  </div>

  <!-- 기록 도크 -->
  <aside class="historyDock">
    <h4 style="text-align:right;color:#d7deef;margin:0 0 10px 0;">추첨 기록</h4>
    <div class="rows" id="historyRows"></div>
    <div class="clear-line"><button class="clear" id="clearHistoryBtn">기록 비우기</button></div>
  </aside>
</div>

<script>
(() => {
  /* ===== 기본 요소 ===== */
  const wheels = [...document.querySelectorAll('.wheel')];
  const wheelH=wheels[0], wheelT=wheels[1], wheelO=wheels[2];
  const drawBtn=document.getElementById('drawBtn');
  const resetBtn=document.getElementById('resetBtn');
  const bigResult=document.getElementById('bigResult');
  const minInput=document.getElementById('minInput');
  const maxInput=document.getElementById('maxInput');

  /* ===== 기록 요소 ===== */
  const rowsEl = document.getElementById('historyRows');
  const clearHistoryBtn = document.getElementById('clearHistoryBtn');
  const history = [];
  function renderHistory(){
    rowsEl.innerHTML='';
    history.forEach((v,i)=>{
      const row=document.createElement('div'); row.className='row';
      row.innerHTML = `<span>${v}</span><span class="idx">#${i+1}</span>`;
      rowsEl.appendChild(row);
    });
    rowsEl.scrollTop = rowsEl.scrollHeight;
  }
  function addHistory(n){
    history.push(n);
    if(history.length>300) history.shift();
    renderHistory();
  }
  clearHistoryBtn.onclick=()=>{ history.length=0; renderHistory(); };

  /* ===== 폭죽 ===== */
  const fx = document.getElementById('fx'), ctx = fx.getContext('2d');
  function resizeFx(){ fx.width = innerWidth; fx.height = innerHeight; }
  addEventListener('resize', resizeFx); resizeFx();
  function burst(x,y,count=140,dur=2000){
    const ps=[]; for(let i=0;i<count;i++){ const a=Math.random()*Math.PI*2,s=2+Math.random()*5;
      ps.push({x,y,vx:Math.cos(a)*s,vy:Math.sin(a)*s,life:dur,size:2+Math.random()*3,col:`hsl(${~~(Math.random()*360)},90%,60%)`});
    }
    const start=performance.now();
    function step(t){
      const dt=t-start; ctx.clearRect(0,0,fx.width,fx.height);
      for(const p of ps){ p.vy+=0.02; p.vx*=0.995; p.vy*=0.995; p.x+=p.vx; p.y+=p.vy;
        ctx.globalAlpha=Math.max(0,1-dt/p.life); ctx.fillStyle=p.col;
        ctx.beginPath(); ctx.arc(p.x,p.y,p.size,0,Math.PI*2); ctx.fill();
      }
      ctx.globalAlpha=1; if(dt<dur) requestAnimationFrame(step);
    }
    requestAnimationFrame(step);
  }
  function celebrate(){
    const panelRect=document.querySelector('.panel').getBoundingClientRect();
    burst(panelRect.left+panelRect.width/2, panelRect.top+panelRect.height/2, 150, 1800);
  }

  /* ===== 스트립 구성 ===== */
  const STRIP_REP=40, baseLen=10;
  function buildStrip(wheel){
    const strip=wheel.querySelector('.digit-strip'); strip.innerHTML='';
    for(let r=0;r<STRIP_REP;r++) for(let d=0; d<10; d++){
      const el=document.createElement('div'); el.className='digit'; el.textContent=d; strip.appendChild(el);
    }
  }
  wheels.forEach(buildStrip);

  /* ===== 뷰포트/높이 ===== */
  const digitHeight=()=>Math.round(document.querySelector('.digit').getBoundingClientRect().height);
  function applyViewport(){
    const h=digitHeight();
    document.documentElement.style.setProperty('--digitH', `${h}px`);
    wheels.forEach(w => { w.style.height = `${h*3}px`; });
  }

  /* ===== 인덱스 계산 ===== */
  const VISIBLE_REP=4, TARGET_REP=20;
  const MAX_TARGET_INDEX = STRIP_REP*baseLen - baseLen*2; // 끝에서 2바퀴 여유
  const visibleBaseIndex = (digit) => VISIBLE_REP*baseLen + (digit - 1); // (digit-1) 보정 유지

  /* ===== 이징/애니메이션 ===== */
  const easeOutQuint = t => 1 - Math.pow(1 - t, 5);
  function getTranslateY(el){
    const tr = getComputedStyle(el).transform;
    if(!tr || tr==='none') return 0;
    if(tr.startsWith('matrix3d(')){
      const p = tr.slice(9,-1).split(',').map(Number);
      return p[13] || 0;
    }else if(tr.startsWith('matrix(')){
      const p = tr.slice(7,-1).split(',').map(Number);
      return p[5] || 0;
    }
    return 0;
  }
  function animateToIndex(wheel, endIndex, duration){
    return new Promise(res=>{
      const strip = wheel.querySelector('.digit-strip');
      const startY = getTranslateY(strip);
      const endY = -endIndex * digitHeight();
      const start = performance.now();
      const step = now => {
        const t = Math.min(1, (now - start)/duration);
        const p = easeOutQuint(t);
        const y = startY + (endY - startY)*p;
        strip.style.transition='none';
        strip.style.transform=`translate3d(0, ${y}px, 0)`;
        if(t<1) requestAnimationFrame(step); else res();
      };
      requestAnimationFrame(step);
    });
  }

  function setInstant(wheel,digit){
    const strip=wheel.querySelector('.digit-strip');
    strip.style.transition='none';
    strip.style.transform=`translate3d(0, ${-visibleBaseIndex(digit)*digitHeight()}px, 0)`;
  }

  async function spinToDigit(wheel, digit, extraLoops, duration){
    const raw = (TARGET_REP + extraLoops) * baseLen + (digit - 1);
    const targetIdx = Math.min(raw, MAX_TARGET_INDEX);
    await animateToIndex(wheel, targetIdx, duration);
    // 스냅 중앙
    const strip=wheel.querySelector('.digit-strip');
    strip.style.transition='none';
    strip.style.transform=`translate3d(0, ${-visibleBaseIndex(digit)*digitHeight()}px, 0)`;
  }

  /* ===== 범위 랜덤 ===== */
  function getRandomInRange(min,max){
    min = Math.floor(isFinite(min)?min:1);
    max = Math.floor(isFinite(max)?max:100);
    if(min===max) max = min+1;
    if(min>max){ const t=min; min=max; max=t; }
    // 0~999로 제한(3자리 UI)
    min = Math.max(0, Math.min(999, min));
    max = Math.max(0, Math.min(999, max));
    return Math.floor(Math.random()*(max-min+1))+min;
  }

  /* ===== 메인 로직: 3자리 동시에 3초 ===== */
  const EXTRA_H=10, EXTRA_T=12, EXTRA_O=14;
  const TOTAL_SPIN=3000;
  let spinning=false;

  async function spinTo(n){
    if(spinning) return; spinning=true; drawBtn.disabled=true;
    n = Math.max(0, Math.min(999, Math.round(n)));

    const h = Math.floor(n/100), t = Math.floor((n%100)/10), o = n%10;

    await Promise.all([
      spinToDigit(wheelH, h, EXTRA_H, TOTAL_SPIN),
      spinToDigit(wheelT, t, EXTRA_T, TOTAL_SPIN),
      spinToDigit(wheelO, o, EXTRA_O, TOTAL_SPIN),
    ]);

    bigResult.textContent = String(n).padStart( (Math.max(minInput.value, maxInput.value) >= 100 ? 3 : 2), '0');
    addHistory(bigResult.textContent);
    celebrate();

    spinning=false; drawBtn.disabled=false;
  }

  /* ===== 바인딩 ===== */
  drawBtn.onclick=()=>{
    const min = parseFloat(minInput.value);
    const max = parseFloat(maxInput.value);
    const target = getRandomInRange(min,max);
    bigResult.textContent='...';
    spinTo(target);
  };
  resetBtn.onclick=()=>{
    [wheelH,wheelT,wheelO].forEach(w=>setInstant(w,0));
    bigResult.textContent='—';
  };

  /* ===== 초기화 ===== */
  function init(){
    applyViewport();
    [wheelH,wheelT,wheelO].forEach(w=>setInstant(w,0));
    renderHistory();
  }
  window.addEventListener('load', init);
  window.addEventListener('resize', init);
})();
</script>
</body>
</html>
