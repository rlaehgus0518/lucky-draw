<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Lucky Draw</title>
<style>
  :root{ --panel:#0f1724; --accent:#ffd166; --text:#f8fafc; --rowh:48px; }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,"Apple SD Gothic Neo","Malgun Gothic",sans-serif;background:#07122a;color:var(--text);}
  .wrap{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:22px;padding:32px;box-sizing:border-box}

  .title{font-size:96px;font-weight:1000;letter-spacing:2px;color:#e8edf7;text-shadow:0 6px 26px rgba(0,0,0,.45);margin-bottom:20px;}
  .btn{background:transparent;border:1px solid rgba(255,255,255,0.1);padding:12px 20px;border-radius:12px;color:#fff;cursor:pointer;font-weight:800;font-size:18px;}
  .btn.primary{background:var(--accent);color:#081022;border:0}
  .btn:active{transform:translateY(1px)}
  input{width:120px;padding:10px 12px;border-radius:8px;border:none;text-align:center;font-size:18px;}

  .setup-screen{display:flex;flex-direction:column;align-items:center;gap:18px;}
  .range-line{display:flex;align-items:center;gap:12px;font-size:22px;}

  /* ===== 추첨기 ===== */
  .draw-screen{display:none;flex-direction:column;align-items:center;gap:22px;}
  .stage{width:100%;max-width:1200px;display:flex;justify-content:center;}
  .centerStack{display:flex;flex-direction:column;gap:18px;align-items:center}
  .panel{width:520px;max-width:90vw;border-radius:12px;background:linear-gradient(180deg,#071a2b,#052036);
    display:flex;align-items:center;justify-content:center;padding:18px 20px;box-sizing:border-box;overflow:hidden;
    box-shadow:0 10px 30px rgba(2,6,23,0.6)}
  .display{display:flex;gap:12px;align-items:center;z-index:2}
  .wheel{width:120px;background:linear-gradient(180deg,#0a2736,#06202c);
    border-radius:10px;display:flex;align-items:center;justify-content:center;
    overflow:hidden;position:relative;border:2px solid rgba(255,255,255,0.04)}
  .digit-strip{position:absolute;top:0;left:0;right:0;display:block;transform:translateY(0);}
  .digit{height:48px;line-height:48px;text-align:center;font-weight:800;font-size:44px;color:var(--accent);
    text-shadow:0 2px 8px rgba(0,0,0,0.6);}
  .focus-frame{position:absolute;left:8px;right:8px;top:0;bottom:0;margin:auto;
    height:calc(var(--digitH,48px));border:3px solid rgba(255,209,102,.9);border-radius:10px;
    box-shadow:0 0 16px rgba(255,209,102,.25),inset 0 0 8px rgba(255,209,102,.25);}
  .actions{display:flex;gap:10px;margin-top:8px;}
  .big-result-wrap{width:520px;max-width:90vw;background:rgba(10,20,35,.55);
    border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:12px 16px;margin-top:12px;}
  .big-result{text-align:center;font-size:112px;font-weight:1000;color:#ffe08a;text-shadow:0 6px 24px rgba(0,0,0,.5)}

  /* 기록 */
  .historyDock{position:fixed;right:24px;top:170px;width:360px;background:rgba(10,20,35,.55);
    border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:12px;backdrop-filter:blur(2px);
    box-shadow:0 10px 30px rgba(2,6,23,.6);}
  .rows{display:flex;flex-direction:column;gap:8px;overflow:auto;max-height:calc(var(--rowh)*6 + 16px);}
  .row{display:flex;align-items:center;justify-content:space-between;background:rgba(255,255,255,.06);
    border-radius:10px;padding:10px 12px;font-size:20px;height:var(--rowh)}
  .row .idx{font-size:12px;color:#b9c2d8}
  .clear-line{display:flex;justify-content:flex-end;margin-top:10px}
  .clear{font-size:12px;padding:6px 10px;border-radius:8px;border:1px solid rgba(255,255,255,.12);
    background:transparent;color:#dbe3f9}
</style>
</head>
<body>
<div class="wrap">

  <!-- ① 범위 설정 화면 -->
  <div class="setup-screen" id="setupScreen">
    <div class="title">Lucky Draw</div>
    <div class="range-line">
      <label>범위:</label>
      <input type="number" id="minSetup" value="1" min="0">
      <span>~</span>
      <input type="number" id="maxSetup" value="100" min="1">
    </div>
    <button class="btn primary" id="startBtn">시작하기</button>
  </div>

  <!-- ② 추첨기 화면 -->
  <div class="draw-screen" id="drawScreen">
    <div class="title">Lucky Draw</div>
    <div class="stage">
      <div class="centerStack">
        <div class="panel">
          <div class="display">
            <div class="wheel" data-pos="h"><div class="digit-strip"></div><div class="focus-frame"></div></div>
            <div class="wheel" data-pos="t"><div class="digit-strip"></div><div class="focus-frame"></div></div>
            <div class="wheel" data-pos="o"><div class="digit-strip"></div><div class="focus-frame"></div></div>
          </div>
        </div>
        <div class="actions">
          <button class="btn primary" id="drawBtn">추첨</button>
          <button class="btn" id="resetBtn">Reset</button>
        </div>
        <div class="big-result-wrap">
          <div id="bigResult" class="big-result">—</div>
        </div>
      </div>
    </div>

    <aside class="historyDock">
      <h4 style="text-align:right;color:#d7deef;margin:0 0 10px 0;">추첨 기록</h4>
      <div class="rows" id="historyRows"></div>
      <div class="clear-line"><button class="clear" id="clearHistoryBtn">기록 비우기</button></div>
    </aside>
  </div>
</div>

<script>
(() => {
  const setupScreen = document.getElementById('setupScreen');
  const drawScreen = document.getElementById('drawScreen');
  const startBtn = document.getElementById('startBtn');
  const minSetup = document.getElementById('minSetup');
  const maxSetup = document.getElementById('maxSetup');

  const drawBtn=document.getElementById('drawBtn');
  const resetBtn=document.getElementById('resetBtn');
  const bigResult=document.getElementById('bigResult');
  const rowsEl=document.getElementById('historyRows');
  const clearHistoryBtn=document.getElementById('clearHistoryBtn');

  let minRange=1,maxRange=100;

  /* 폭죽 */
  const fx=document.createElement('canvas'); fx.id='fx'; fx.style.cssText='position:fixed;inset:0;pointer-events:none;z-index:50;';
  document.body.appendChild(fx);
  const ctx=fx.getContext('2d');
  function resizeFx(){fx.width=innerWidth;fx.height=innerHeight;} addEventListener('resize',resizeFx); resizeFx();
  function burst(x,y,count=120,dur=2000){
    const ps=[];for(let i=0;i<count;i++){const a=Math.random()*Math.PI*2,s=2+Math.random()*5;
      ps.push({x,y,vx:Math.cos(a)*s,vy:Math.sin(a)*s,life:dur,size:2+Math.random()*3,col:`hsl(${~~(Math.random()*360)},90%,60%)`});
    }
    const start=performance.now();
    function step(t){
      const dt=t-start;ctx.clearRect(0,0,fx.width,fx.height);
      for(const p of ps){p.vy+=0.02;p.vx*=0.995;p.vy*=0.995;p.x+=p.vx;p.y+=p.vy;
        ctx.globalAlpha=Math.max(0,1-dt/p.life);ctx.fillStyle=p.col;ctx.beginPath();ctx.arc(p.x,p.y,p.size,0,Math.PI*2);ctx.fill();}
      ctx.globalAlpha=1;if(dt<dur)requestAnimationFrame(step);
    }
    requestAnimationFrame(step);
  }

  /* 휠 구성 */
  const wheels=[...document.querySelectorAll('.wheel')];
  const wheelH=wheels[0],wheelT=wheels[1],wheelO=wheels[2];
  const STRIP_REP=40,baseLen=10;
  function buildStrip(w){
    const s=w.querySelector('.digit-strip');s.innerHTML='';
    for(let r=0;r<STRIP_REP;r++)for(let d=0;d<10;d++){
      const e=document.createElement('div');e.className='digit';e.textContent=d;s.appendChild(e);
    }
  }wheels.forEach(buildStrip);

  const digitHeight=()=>Math.round(document.querySelector('.digit').getBoundingClientRect().height);
  function applyViewport(){
    const h=digitHeight();
    document.documentElement.style.setProperty('--digitH',`${h}px`);
    wheels.forEach(w=>{w.style.height=`${h*3}px`;});
  }
  const VISIBLE_REP=4,TARGET_REP=20;
  const visibleBaseIndex=d=>VISIBLE_REP*baseLen+(d-1);
  const easeOutQuint=t=>1-Math.pow(1-t,5);
  const getTranslateY=el=>{
    const tr=getComputedStyle(el).transform;
    if(!tr||tr==='none')return 0;
    const p=tr.startsWith('matrix3d(')?tr.slice(9,-1).split(','):tr.slice(7,-1).split(',');
    return parseFloat(p[13]||p[5]||0);
  }
  function animateToIndex(w,end,dur){
    return new Promise(res=>{
      const s=w.querySelector('.digit-strip');
      const startY=getTranslateY(s);
      const endY=-end*digitHeight();
      const start=performance.now();
      const step=now=>{
        const t=Math.min(1,(now-start)/dur);
        const p=easeOutQuint(t);
        const y=startY+(endY-startY)*p;
        s.style.transform=`translate3d(0,${y}px,0)`;
        if(t<1)requestAnimationFrame(step);else res();
      };
      requestAnimationFrame(step);
    });
  }
  function setInstant(w,d){const s=w.querySelector('.digit-strip');
    s.style.transition='none';s.style.transform=`translate3d(0,${-visibleBaseIndex(d)*digitHeight()}px,0)`;}
  async function spinToDigit(w,d,loops,dur){
    const target=(TARGET_REP+loops)*baseLen+(d-1);
    await animateToIndex(w,target,dur);
    const s=w.querySelector('.digit-strip');
    s.style.transform=`translate3d(0,${-visibleBaseIndex(d)*digitHeight()}px,0)`;
  }

  /* 기록 */
  const history=[];
  function renderHistory(){rowsEl.innerHTML='';history.forEach((v,i)=>{
    const r=document.createElement('div');r.className='row';r.innerHTML=`<span>${v}</span><span class="idx">#${i+1}</span>`;rowsEl.appendChild(r);
  });rowsEl.scrollTop=rowsEl.scrollHeight;}
  clearHistoryBtn.onclick=()=>{history.length=0;renderHistory();};

  /* 랜덤 */
  const getRand=(min,max)=>Math.floor(Math.random()*(max-min+1))+min;

  /* 추첨 */
  const EXTRA_H=10,EXTRA_T=12,EXTRA_O=14,SPIN_TIME=3000;
  let spinning=false;
  async function spinTo(n){
    if(spinning)return;spinning=true;drawBtn.disabled=true;
    const h=Math.floor(n/100),t=Math.floor((n%100)/10),o=n%10;
    await Promise.all([
      spinToDigit(wheelH,h,EXTRA_H,SPIN_TIME),
      spinToDigit(wheelT,t,EXTRA_T,SPIN_TIME),
      spinToDigit(wheelO,o,EXTRA_O,SPIN_TIME),
    ]);
    bigResult.textContent=n;
    history.push(n);renderHistory();
    burst(innerWidth/2,innerHeight/2);
    spinning=false;drawBtn.disabled=false;
  }

  drawBtn.onclick=()=>{const n=getRand(minRange,maxRange);bigResult.textContent='...';spinTo(n);}
  resetBtn.onclick=()=>{[wheelH,wheelT,wheelO].forEach(w=>setInstant(w,0));bigResult.textContent='—';}

  function init(){applyViewport();[wheelH,wheelT,wheelO].forEach(w=>setInstant(w,0));}
  window.addEventListener('load',init);window.addEventListener('resize',init);

  /* 시작 버튼 동작 */
  startBtn.onclick=()=>{
    minRange=parseInt(minSetup.value)||1;
    maxRange=parseInt(maxSetup.value)||100;
    if(minRange>=maxRange)maxRange=minRange+1;
    setupScreen.style.display='none';
    drawScreen.style.display='flex';
    init();
  };
})();
</script>
</body>
</html>
