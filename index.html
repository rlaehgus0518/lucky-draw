<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Lucky Draw</title>
<style>
  :root{
    --panel:#0f1724; --accent:#ffd166; --text:#f8fafc; --rowh:48px;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,"Apple SD Gothic Neo","Malgun Gothic",sans-serif;background:#07122a;color:var(--text);}
  .wrap{min-height:100vh;display:flex;flex-direction:column;align-items:center;gap:22px;padding:32px;box-sizing:border-box}
  .title{font-size:128px;font-weight:1000;letter-spacing:2px;color:#e8edf7;text-shadow:0 6px 26px rgba(0,0,0,.45)}

  .stage{width:100%;max-width:1200px;display:flex;justify-content:center;}
  .centerStack{display:flex;flex-direction:column;gap:18px;align-items:center}

  .panel{width:520px;max-width:90vw;border-radius:12px;background:linear-gradient(180deg,#071a2b,#052036);
    display:flex;align-items:center;justify-content:center;padding:18px 20px;box-sizing:border-box;overflow:hidden;
    box-shadow:0 10px 30px rgba(2,6,23,0.6)}
  .display{display:flex;gap:12px;align-items:center;z-index:2}

  .wheel{
    width:120px;background:linear-gradient(180deg,#0a2736,#06202c);
    border-radius:10px;display:flex;align-items:center;justify-content:center;
    overflow:hidden;position:relative;border:2px solid rgba(255,255,255,0.04)
  }
  .digit-strip{
    position:absolute;top:0;left:0;right:0;display:block;transform:translateY(0);
    will-change:transform; backface-visibility:hidden;
  }
  .digit{
    height:48px;line-height:48px;text-align:center;font-weight:800;font-size:44px;color:var(--accent);
    text-shadow:0 2px 8px rgba(0,0,0,0.6);
    transition:transform 120ms ease-out;
  }
  .digit.current{transform:scale(1.3);font-weight:1000;}

  .wheel::before,.wheel::after{content:"";position:absolute;left:0;right:0;height:28%;pointer-events:none}
  .wheel::before{top:0;background:linear-gradient(to bottom,rgba(7,18,42,.85),rgba(7,18,42,0))}
  .wheel::after{bottom:0;background:linear-gradient(to top,rgba(7,18,42,.85),rgba(7,18,42,0))}

  .focus-frame{
    position:absolute;left:8px;right:8px;margin:auto;
    height:calc(var(--digitH,48px));
    border:3px solid rgba(255,209,102,.9);border-radius:10px;
    box-shadow:0 0 16px rgba(255,209,102,.25),inset 0 0 8px rgba(255,209,102,.25);
    pointer-events:none;
  }

  .actions{display:flex;gap:10px}
  .btn{background:transparent;border:1px solid rgba(255,255,255,0.08);padding:12px 18px;border-radius:12px;color:#fff;cursor:pointer;font-weight:800}
  .btn.primary{background:var(--accent);color:#081022;border:0}
  .btn:active{transform:translateY(1px)}
  .big-result-wrap{width:520px;max-width:90vw;background:rgba(10,20,35,.55);border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:12px 16px}
  .big-result-title{text-align:center;color:#d7deef;margin:0 0 6px 0;font-size:13px}
  .big-result{text-align:center;font-size:112px;line-height:1;font-weight:1000;letter-spacing:4px;color:#ffe08a;text-shadow:0 6px 24px rgba(0,0,0,.5)}

  .historyDock{
    position:fixed;right:24px;top:170px;width:360px;
    background:rgba(10,20,35,.55);border:1px solid rgba(255,255,255,.06);
    border-radius:12px;padding:12px;backdrop-filter:blur(2px);
    box-shadow:0 10px 30px rgba(2,6,23,.6);
  }
  .rows{display:flex;flex-direction:column;gap:8px;overflow:auto;max-height:calc(var(--rowh)*6 + 16px);}
  .row{display:flex;align-items:center;justify-content:space-between;background:rgba(255,255,255,.06);border-radius:10px;padding:10px 12px;font-size:20px;height:var(--rowh)}
  .row .idx{font-size:12px;color:#b9c2d8}
  .clear-line{display:flex;justify-content:flex-end;margin-top:10px}
  .clear{font-size:12px;padding:6px 10px;border-radius:8px;border:1px solid rgba(255,255,255,.12);background:transparent;color:#dbe3f9}
  #fx{position:fixed;inset:0;pointer-events:none;z-index:50}
</style>
</head>
<body>
<canvas id="fx"></canvas>
<div class="wrap">
  <div class="title">Lucky Draw</div>
  <div class="stage">
    <div class="centerStack">
      <div class="panel" id="panel">
        <div class="display">
          <div class="wheel" data-pos="h"><div class="digit-strip"></div><div class="focus-frame"></div></div>
          <div class="wheel" data-pos="t"><div class="digit-strip"></div><div class="focus-frame"></div></div>
          <div class="wheel" data-pos="o"><div class="digit-strip"></div><div class="focus-frame"></div></div>
        </div>
      </div>
      <div class="actions">
        <button class="btn primary" id="drawBtn">추첨</button>
        <button class="btn" id="resetBtn">Reset</button>
      </div>
      <div class="big-result-wrap">
        <p class="big-result-title">결과</p>
        <div id="bigResult" class="big-result">—</div>
      </div>
    </div>
  </div>
  <aside class="historyDock">
    <h4 style="text-align:right;color:#d7deef;margin:0 0 10px 0;">추첨 기록</h4>
    <div class="rows" id="historyRows"></div>
    <div class="clear-line"><button class="clear" id="clearHistoryBtn">기록 비우기</button></div>
  </aside>
</div>
<script>
(() => {
  const wheels=[...document.querySelectorAll('.wheel')];
  const wheelH=wheels[0],wheelT=wheels[1],wheelO=wheels[2];
  const drawBtn=document.getElementById('drawBtn'),resetBtn=document.getElementById('resetBtn'),bigResult=document.getElementById('bigResult'),rowsEl=document.getElementById('historyRows'),clearHistoryBtn=document.getElementById('clearHistoryBtn');

  const fx=document.getElementById('fx'),ctx=fx.getContext('2d');
  function resizeFx(){fx.width=innerWidth;fx.height=innerHeight;}addEventListener('resize',resizeFx);resizeFx();
  function burst(x,y,count=140,dur=3000){const ps=[];for(let i=0;i<count;i++){const a=Math.random()*Math.PI*2,s=2+Math.random()*5;ps.push({x,y,vx:Math.cos(a)*s,vy:Math.sin(a)*s,life:dur,size:2+Math.random()*3,col:`hsl(${~~(Math.random()*360)},90%,60%)`});}const start=performance.now();function step(t){const dt=t-start;ctx.clearRect(0,0,fx.width,fx.height);for(const p of ps){p.vy+=0.02;p.vx*=0.995;p.vy*=0.995;p.x+=p.vx;p.y+=p.vy;ctx.globalAlpha=Math.max(0,1-dt/p.life);ctx.fillStyle=p.col;ctx.beginPath();ctx.arc(p.x,p.y,p.size,0,Math.PI*2);ctx.fill();}ctx.globalAlpha=1;if(dt<dur)requestAnimationFrame(step);}requestAnimationFrame(step);}
  function celebrate(){const r=document.getElementById('panel').getBoundingClientRect();burst(r.left+r.width/2,r.top+r.height/2,160,3000);setTimeout(()=>burst(innerWidth*0.25,innerHeight*0.35,120,3000),1000);setTimeout(()=>burst(innerWidth*0.75,innerHeight*0.35,120,3000),2000);}

  const digitHeight=()=>document.querySelector('.digit').getBoundingClientRect().height;
  const STRIP_REP=40,TARGET_REP=20,baseLen=10,EXTRA_LOOPS=14,SPIN_MS=9000; // 회전 길이/시간 늘림

  function buildStrip(wheel){const s=wheel.querySelector('.digit-strip');s.innerHTML='';for(let r=0;r<STRIP_REP;r++){for(let d=0;d<10;d++){const e=document.createElement('div');e.className='digit';e.textContent=d;s.appendChild(e);}}}
  wheels.forEach(buildStrip);
  function applyH(){const h=digitHeight();document.documentElement.style.setProperty('--digitH',`${h}px`);wheels.forEach(w=>w.style.height=`${h*3}px`);}
  const EASE='cubic-bezier(.08,.72,.12,.99)';
  const visibleBaseIndex=d=>4*baseLen+(d-1);
  async function moveToIndex(w,i,dur){return new Promise(r=>{const s=w.querySelector('.digit-strip');s.style.transition=`transform ${dur}ms ${EASE}`;requestAnimationFrame(()=>s.style.transform=`translate3d(0,${-i*digitHeight()}px,0)`);s.addEventListener('transitionend',()=>r(),{once:true});});}
  function markCurrent(w){const s=w.querySelector('.digit-strip');const center=w.getBoundingClientRect().top+w.getBoundingClientRect().height/2;const ds=[...s.children];let best=null,dist=1e9;for(const d of ds){const r=d.getBoundingClientRect(),m=r.top+r.height/2;if(Math.abs(m-center)<dist){dist=Math.abs(m-center);best=d;}d.classList.remove('current');}if(best)best.classList.add('current');}
  async function spinToDigit(w,dig,extra,dur){w.querySelectorAll('.digit').forEach(d=>d.classList.remove('current'));const target=(TARGET_REP+extra)*baseLen+(dig-1);await moveToIndex(w,target,dur);const s=w.querySelector('.digit-strip');s.style.transition='none';s.style.transform=`translate3d(0,${-visibleBaseIndex(dig)*digitHeight()}px,0)`;markCurrent(w);}
  function split(n){n=Math.max(1,Math.min(100,Math.round(n)));return[Math.floor(n/100),Math.floor((n%100)/10),n%10];}
  function randomDraw(){return Math.floor(Math.random()*100)+1;}
  const pad3=n=>n===100?"100":String(n).padStart(3,'0');
  const history=[];function renderHistory(){rowsEl.innerHTML='';history.forEach((v,i)=>{const r=document.createElement('div');r.className='row';r.innerHTML=`<span>${v}</span><span class="idx">#${i+1}</span>`;rowsEl.appendChild(r);});rowsEl.scrollTop=rowsEl.scrollHeight;}
  function addHistory(n){history.push(n);if(history.length>300)history.shift();renderHistory();}
  clearHistoryBtn.onclick=()=>{history.length=0;renderHistory();};

  let spinning=false;
  async function spinTo(n){
    if(spinning)return;spinning=true;
    n=Math.max(1,Math.min(100,n));
    const[h,t,o]=split(n);
    const H=n===100?1:0,T=n===100?0:t,O=n===100?0:o;
    await Promise.all([
      spinToDigit(wheelH,H,EXTRA_LOOPS,SPIN_MS),
      spinToDigit(wheelT,T,EXTRA_LOOPS,SPIN_MS),
      spinToDigit(wheelO,O,EXTRA_LOOPS,SPIN_MS)
    ]);
    bigResult.textContent=pad3(n);addHistory(n);celebrate();spinning=false;drawBtn.disabled=false;
  }

  document.getElementById('panel').onclick=()=>{if(!drawBtn.disabled)drawBtn.click();};
  drawBtn.onclick=()=>{if(spinning)return;drawBtn.disabled=true;bigResult.textContent='...';spinTo(randomDraw());};
  resetBtn.onclick=()=>{[wheelH,wheelT,wheelO].forEach(w=>{const s=w.querySelector('.digit-strip');s.style.transition='none';s.style.transform='translate3d(0,0,0)';});bigResult.textContent='—';spinning=false;drawBtn.disabled=false;};

  function init(){applyH();markCurrent(wheelH);markCurrent(wheelT);markCurrent(wheelO);}
  window.onload=init;window.onresize=init;
})();
</script>
</body>
</html>

